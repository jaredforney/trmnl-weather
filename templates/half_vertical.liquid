<!-- SVG Weather Icons (inline - no external dependencies) -->
{% capture icon_sun %}<svg viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="5"/><path d="M12 2v3m0 14v3M2 12h3m14 0h3M5.6 5.6l2 2m8.8 8.8l2 2M5.6 18.4l2-2m8.8-8.8l2-2"/></svg>{% endcapture %}

{% capture icon_partly_cloudy %}<svg viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"><circle cx="8" cy="7" r="3"/><path d="M8 2v1.5M8 12v1.5M3 7h1.5M13 7h1.5M5 4l1 1M10 9l1 1M5 10l1-1M10 4l1-1"/><path d="M21 16a4 4 0 00-4-4h-.5a6 6 0 00-11 1.5A3.5 3.5 0 009 20h8a4 4 0 004-4z" fill="#fff"/><path d="M21 16a4 4 0 00-4-4h-.5a6 6 0 00-11 1.5A3.5 3.5 0 009 20h8a4 4 0 004-4z"/></svg>{% endcapture %}

{% capture icon_cloud %}<svg viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"><path d="M18 10h-1.3A8 8 0 109 20h9a5 5 0 000-10z"/></svg>{% endcapture %}

{% capture icon_rain %}<svg viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"><path d="M20 16.6A5 5 0 0018 7h-1.3A8 8 0 104 15.3"/><path d="M16 13v8M8 13v8M12 15v8"/></svg>{% endcapture %}

{% capture icon_thunder %}<svg viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"><path d="M19 16.9A5 5 0 0018 7h-1.3a8 8 0 10-11.6 9"/><path d="M13 11l-4 6h6l-4 6"/></svg>{% endcapture %}

{% capture icon_snow %}<svg viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"><path d="M20 17.6A5 5 0 0018 8h-1.3A8 8 0 104 16.3"/><circle cx="8" cy="17" r=".75" fill="#000"/><circle cx="8" cy="21" r=".75" fill="#000"/><circle cx="12" cy="19" r=".75" fill="#000"/><circle cx="16" cy="17" r=".75" fill="#000"/><circle cx="16" cy="21" r=".75" fill="#000"/></svg>{% endcapture %}

{% capture icon_fog %}<svg viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"><path d="M3 6h18M3 10h14M3 14h18M3 18h10"/></svg>{% endcapture %}

<!-- Compute temperature marker position via Liquid (JS doesn't run in TRMNL renderer) -->
{% assign temp_range = forecast[0].high_f | minus: forecast[0].low_f %}
{% assign temp_offset = current.temp_f | minus: forecast[0].low_f %}
{% if temp_range > 0 %}
  {% assign marker_pct = temp_offset | times: 100 | divided_by: temp_range %}
{% else %}
  {% assign marker_pct = 50 %}
{% endif %}
{% if marker_pct < 0 %}{% assign marker_pct = 0 %}{% endif %}
{% if marker_pct > 100 %}{% assign marker_pct = 100 %}{% endif %}

<style>
    .weather-container {
        padding: 24px;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .current-section {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .divider {
        border: none;
        border-top: 2px dotted #000;
        height: 0;
        width: 100%;
        margin: 8px 0;
    }

    .forecast-section {
        display: flex;
        flex-direction: column;
        flex: 1;
    }

    .location-name {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 4px;
        color: #000;
        text-align: center;
    }

    .current-main {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
    }

    .weather-temp-group {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
    }

    .weather-icon svg {
        width: 44px;
        height: 44px;
    }

    .temperature {
        font-size: 56px;
        font-weight: 300;
        line-height: 1;
        color: #000;
        flex-shrink: 0;
        text-align: center;
    }

    .temp-range {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 24px;
        margin-bottom: 8px;
        font-size: 16px;
        color: #000;
    }

    .temp-bar {
        flex: 1;
        height: 5px;
        background: repeating-linear-gradient(
            90deg,
            #000 0px,
            #000 1px,
            transparent 1px,
            transparent 5px
        );
        position: relative;
        min-width: 100px;
    }

    .current-marker {
        position: absolute;
        top: -2px;
        height: 9px;
        width: 3px;
        background: #000;
    }

    .current-condition {
        text-align: center;
        margin-bottom: 8px;
        font-size: 14px;
        color: #000;
    }

    .details-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        gap: 6px 28px;
        font-size: 12px;
        color: #000;
        justify-content: center;
    }

    .detail-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px;
    }

    .detail-label {
        font-weight: 400;
        font-size: 10px;
    }

    .detail-value {
        font-weight: 600;
        font-size: 14px;
    }

    .forecast-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 4px;
        color: #000;
    }

    .forecast-table {
        display: flex;
        flex-direction: column;
        gap: 0;
        flex: 1;
    }

    .forecast-row {
        display: grid;
        grid-template-columns: 1.4fr 1fr 1fr 1.5fr;
        gap: 18px;
        font-size: 13px;
        color: #000;
        margin-bottom: 8px;
        align-items: center;
        padding: 4px 0;
    }

    .forecast-day {
        font-weight: 600;
        text-align: left;
    }

    .forecast-icon svg {
        width: 20px;
        height: 20px;
    }

    .forecast-icon {
        text-align: center;
    }

    .forecast-rain {
        font-weight: 400;
        text-align: center;
    }

    .forecast-temps {
        font-weight: 400;
        text-align: right;
    }
</style>

<div class="layout">
    <div class="weather-container">
        <!-- Current Weather & Details Section -->
        <div class="current-section">
            <div>
                <div class="location-name">{{ location }}, {{ region }}</div>

                <div class="current-main">
                    <div class="weather-temp-group">
                        <div class="weather-icon">
                            {% if current.icon == 'sun' %}{{ icon_sun }}
                            {% elsif current.icon == 'partly_cloudy' %}{{ icon_partly_cloudy }}
                            {% elsif current.icon == 'rain' %}{{ icon_rain }}
                            {% elsif current.icon == 'thunder' %}{{ icon_thunder }}
                            {% elsif current.icon == 'snow' %}{{ icon_snow }}
                            {% elsif current.icon == 'fog' %}{{ icon_fog }}
                            {% else %}{{ icon_cloud }}
                            {% endif %}
                        </div>
                        <div class="temperature">{{ current.temp_f }}°</div>
                    </div>
                </div>

                <div class="temp-range">
                    <span>{{ forecast[0].low_f }}°</span>
                    <div class="temp-bar">
                        <div class="current-marker" style="left: {{ marker_pct }}%"></div>
                    </div>
                    <span>{{ forecast[0].high_f }}°</span>
                </div>
            </div>

            <div class="current-condition">
                {{ current.condition }}
            </div>

            <div class="details-grid">
                <div class="detail-item">
                    <span class="detail-label">Feels like</span>
                    <span class="detail-value">{{ current.feels_like_f }}°</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Rain</span>
                    <span class="detail-value">{{ forecast[0].rain }}%</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">UV Index</span>
                    <span class="detail-value">{{ current.uv }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Wind</span>
                    <span class="detail-value">{{ current.wind_mph }} mph</span>
                </div>
            </div>
        </div>

        <hr class="divider">

        <!-- 3-Day Forecast Section -->
        <div class="forecast-section">
            <div class="forecast-title">3-Day Forecast</div>
            <div class="forecast-table">
                {% for day in forecast limit:3 %}
                <div class="forecast-row">
                    <div class="forecast-day">
                        {{ day.day }} <span style="font-weight: 400; font-size: 10px;">{{ day.date | date: "%-m/%-d" }}</span>
                    </div>
                    <div class="forecast-icon">
                        {% if day.icon == 'sun' %}{{ icon_sun }}
                        {% elsif day.icon == 'partly_cloudy' %}{{ icon_partly_cloudy }}
                        {% elsif day.icon == 'rain' %}{{ icon_rain }}
                        {% elsif day.icon == 'thunder' %}{{ icon_thunder }}
                        {% elsif day.icon == 'snow' %}{{ icon_snow }}
                        {% elsif day.icon == 'fog' %}{{ icon_fog }}
                        {% else %}{{ icon_cloud }}
                        {% endif %}
                    </div>
                    <div class="forecast-rain">{{ day.rain }}%</div>
                    <div class="forecast-temps">{{ day.low_f }}°/{{ day.high_f }}°</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div class="title_bar">
    <span class="title">Weather</span>
    <span class="instance">{{ location }}, {{ region }}</span>
</div>
